# M365 Digital Twin

## Технико-экономическое обоснование разработки цифрового двойника средства индивидуальной мобильности

---

## О проекте

Проект представляет собой демонстрационную систему цифрового двойника средства индивидуальной мобильности (электросамоката), реализующую:

- мониторинг технического состояния в реальном времени  
- сбор телеметрии через MQTT  
- аналитическую обработку данных  
- хранение временных рядов  
- визуализацию  
- основу для предиктивной диагностики  
- оптимизацию эксплуатации  

Проект разработан в рамках дипломной работы по направлению **Бизнес-информатика**.

---

## Цель проекта

Разработка и обоснование архитектуры цифрового двойника СИМ для:

- повышения эксплуатационной надёжности  
- снижения затрат на обслуживание  
- раннего выявления перегревов и аномалий  
- формирования базы для предиктивной аналитики  

---

## Архитектура системы

### Физический уровень

Микроконтроллер: **ESP8266**

Используемые датчики:

- INA219 — измерение тока и напряжения аккумулятора  
- DS18B20 — температура двигателя и батареи  
- MPU9250 — акселерометр  
- датчик Холла — скорость  
- управление светом и стоп-сигналом  

Питание: 12В → преобразование в 5В  

---

### Программная архитектура

```text
ESP8266 / Emulator
        ↓
     MQTT
        ↓
   Mosquitto (Docker)
        ↓
    Node-RED
  (валидация + подготовка)
        ↓
    InfluxDB 2.x
        ↓
  ┌───────────────┐
  │   Grafana     │
  │   Streamlit   │
  └───────────────┘
```

---

## Сбор телеметрии

Система записывает следующие параметры:

| Поле        | Описание |
|------------|----------|
| u_batt_v   | Напряжение аккумулятора |
| i_batt_a   | Ток аккумулятора |
| t_batt_c   | Температура батареи |
| t_ctrl_c   | Температура контроллера |
| speed_kmh  | Скорость |
| ax_ms2     | Ускорение по X |
| ay_ms2     | Ускорение по Y |
| az_ms2     | Ускорение по Z |

Данные сохраняются в InfluxDB как временные ряды.

---

# Запуск проекта

Проект поддерживает два режима запуска.

---

## Режим 1 — Локальный запуск (legacy)

Инфраструктура запускается вручную:

1. Mosquitto  
2. Node-RED  
3. InfluxDB  
4. Grafana  
5. Streamlit  

Используется для совместимости со старой конфигурацией.

---

## Режим 2 — Docker 

### Запуск инфраструктуры

```bash
docker compose -f infra/docker-compose.yml up -d
```

Контейнеры:

- mosquitto  
- influxdb  
- grafana  
- nodered  

---

### Порты сервисов

| Сервис    | Адрес |
|------------|--------|
| MQTT       | localhost:1884 |
| InfluxDB   | http://localhost:8087 |
| Grafana    | http://localhost:3000 |
| Node-RED   | http://localhost:1880 |

---

### Запуск приложения

```bash
streamlit run streamlit_app.py
```

---

## Аналитический слой

Система позволяет:

- строить временные ряды  
- агрегировать данные  
- анализировать перегрев  
- выявлять аномалии  
- рассчитывать средние значения  
- формировать базу для предиктивных моделей  

---

## Бизнес-ценность

Внедрение цифрового двойника позволяет:

- сократить незапланированные отказы  
- снизить расходы на сервисное обслуживание  
- повысить безопасность эксплуатации  
- создать цифровой профиль устройства  
- подготовить основу для fleet-аналитики  

---

## Структура проекта

```text
api/                — Node.js слой
infra/              — Docker инфраструктура
  ├─ mosquitto/
  ├─ influx2/
  ├─ grafana/
  ├─ nodered/
src/                — исходный код
m365_emulator.py    — эмулятор телеметрии
streamlit_app.py    — интерфейс визуализации
node_red_flow.json  — flow Node-RED
grafana_dashboard.json
```

---

## Возможности развития

- Расчёт SoC (state of charge)
- Предиктивная модель перегрева
- Анализ деградации батареи
- Масштабирование на парк СИМ
- Интеграция с мобильным приложением

---

## Используемые технологии

- ESP8266  
- MQTT  
- Node-RED  
- InfluxDB 2.x  
- Grafana  
- Streamlit  
- Docker  
- Python  
- JavaScript  

---